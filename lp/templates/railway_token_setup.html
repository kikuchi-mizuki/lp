<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Railwayãƒˆãƒ¼ã‚¯ãƒ³è‡ªå‹•è¨­å®š</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .setup-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }
        .step-indicator {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
        }
        .step {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e9ecef;
            color: #6c757d;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 10px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        .step.active {
            background: #007bff;
            color: white;
        }
        .step.completed {
            background: #28a745;
            color: white;
        }
        .setup-card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        .btn-primary {
            background: linear-gradient(45deg, #007bff, #0056b3);
            border: none;
            border-radius: 10px;
            padding: 12px 30px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 123, 255, 0.3);
        }
        .status-indicator {
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
        }
        .copy-btn {
            background: #6c757d;
            border: none;
            border-radius: 5px;
            color: white;
            padding: 5px 10px;
            font-size: 12px;
            cursor: pointer;
        }
        .copy-btn:hover {
            background: #5a6268;
        }
        .token-input {
            font-family: 'Courier New', monospace;
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 12px;
        }
        .token-input:focus {
            border-color: #007bff;
            box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
        }
    </style>
</head>
<body>
    <div class="container py-5">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="setup-container p-5">
                    <h1 class="text-center mb-4">
                        <i class="fas fa-cog fa-spin text-primary"></i>
                        Railwayãƒˆãƒ¼ã‚¯ãƒ³è‡ªå‹•è¨­å®š
                    </h1>
                    
                    <!-- ã‚¹ãƒ†ãƒƒãƒ—ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ -->
                    <div class="step-indicator">
                        <div class="step active" id="step1">1</div>
                        <div class="step" id="step2">2</div>
                        <div class="step" id="step3">3</div>
                        <div class="step" id="step4">4</div>
                    </div>

                    <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º -->
                    <div id="statusArea"></div>

                    <!-- ã‚¹ãƒ†ãƒƒãƒ—1: Railwayãƒˆãƒ¼ã‚¯ãƒ³å–å¾— -->
                    <div class="setup-card card" id="step1Card">
                        <div class="card-header bg-primary text-white">
                            <h5><i class="fas fa-key"></i> ã‚¹ãƒ†ãƒƒãƒ—1: Railwayãƒˆãƒ¼ã‚¯ãƒ³ã®å–å¾—</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <h6>æ‰‹é †:</h6>
                                    <ol>
                                        <li>Railwayãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«ãƒ­ã‚°ã‚¤ãƒ³</li>
                                        <li>å³ä¸Šã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯</li>
                                        <li>"Account Settings"ã‚’é¸æŠ</li>
                                        <li>"API"ã‚¿ãƒ–ã‚’ã‚¯ãƒªãƒƒã‚¯</li>
                                        <li>"Generate Token"ã‚’ã‚¯ãƒªãƒƒã‚¯</li>
                                    </ol>
                                </div>
                                <div class="col-md-6">
                                    <a href="https://railway.app/dashboard" target="_blank" class="btn btn-primary w-100">
                                        <i class="fas fa-external-link-alt"></i>
                                        Railwayãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’é–‹ã
                                    </a>
                                </div>
                            </div>
                            <div class="mt-3">
                                <label for="railwayToken" class="form-label">ç”Ÿæˆã•ã‚ŒãŸãƒˆãƒ¼ã‚¯ãƒ³:</label>
                                <input type="text" class="form-control token-input" id="railwayToken" 
                                       placeholder="railway_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx">
                                <div class="form-text">ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦å…¥åŠ›ã—ã¦ãã ã•ã„</div>
                            </div>
                            <button class="btn btn-success mt-3" onclick="validateToken()">
                                <i class="fas fa-check"></i> ãƒˆãƒ¼ã‚¯ãƒ³ã‚’æ¤œè¨¼
                            </button>
                        </div>
                    </div>

                    <!-- ã‚¹ãƒ†ãƒƒãƒ—2: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆIDå–å¾— -->
                    <div class="setup-card card" id="step2Card" style="display: none;">
                        <div class="card-header bg-info text-white">
                            <h5><i class="fas fa-project-diagram"></i> ã‚¹ãƒ†ãƒƒãƒ—2: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆIDã®å–å¾—</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <h6>æ‰‹é †:</h6>
                                    <ol>
                                        <li>Railwayãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é–‹ã</li>
                                        <li>URLã‹ã‚‰ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆIDã‚’ã‚³ãƒ”ãƒ¼</li>
                                        <li>ä¾‹: https://railway.app/project/3e9475ce-ff6a-4443-ab6c-4eb21b7f4017</li>
                                        <li>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆID: 3e9475ce-ff6a-4443-ab6c-4eb21b7f4017</li>
                                    </ol>
                                </div>
                                <div class="col-md-6">
                                    <a href="https://railway.app/dashboard" target="_blank" class="btn btn-info w-100">
                                        <i class="fas fa-external-link-alt"></i>
                                        ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§ã‚’é–‹ã
                                    </a>
                                </div>
                            </div>
                            <div class="mt-3">
                                <label for="projectId" class="form-label">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆID:</label>
                                <input type="text" class="form-control token-input" id="projectId" 
                                       placeholder="3e9475ce-ff6a-4443-ab6c-4eb21b7f4017">
                                <div class="form-text">URLã‹ã‚‰ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆIDã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„</div>
                            </div>
                            <button class="btn btn-success mt-3" onclick="validateProjectId()">
                                <i class="fas fa-check"></i> ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆIDã‚’æ¤œè¨¼
                            </button>
                        </div>
                    </div>

                    <!-- ã‚¹ãƒ†ãƒƒãƒ—3: ç’°å¢ƒå¤‰æ•°è¨­å®š -->
                    <div class="setup-card card" id="step3Card" style="display: none;">
                        <div class="card-header bg-warning text-dark">
                            <h5><i class="fas fa-cogs"></i> ã‚¹ãƒ†ãƒƒãƒ—3: ç’°å¢ƒå¤‰æ•°ã®è‡ªå‹•è¨­å®š</h5>
                        </div>
                        <div class="card-body">
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle"></i>
                                ä»¥ä¸‹ã®ç’°å¢ƒå¤‰æ•°ã‚’è‡ªå‹•ã§è¨­å®šã—ã¾ã™
                            </div>
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="card">
                                        <div class="card-body text-center">
                                            <h6>RAILWAY_TOKEN</h6>
                                            <code id="displayToken">æœªè¨­å®š</code>
                                            <button class="copy-btn mt-2" onclick="copyToClipboard('displayToken')">
                                                <i class="fas fa-copy"></i> ã‚³ãƒ”ãƒ¼
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="card">
                                        <div class="card-body text-center">
                                            <h6>RAILWAY_PROJECT_ID</h6>
                                            <code id="displayProjectId">æœªè¨­å®š</code>
                                            <button class="copy-btn mt-2" onclick="copyToClipboard('displayProjectId')">
                                                <i class="fas fa-copy"></i> ã‚³ãƒ”ãƒ¼
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="card">
                                        <div class="card-body text-center">
                                            <h6>BASE_DOMAIN</h6>
                                            <code id="displayDomain">lp-production-9e2c.up.railway.app</code>
                                            <button class="copy-btn mt-2" onclick="copyToClipboard('displayDomain')">
                                                <i class="fas fa-copy"></i> ã‚³ãƒ”ãƒ¼
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <button class="btn btn-warning mt-3 w-100" onclick="setupEnvironmentVariables()">
                                <i class="fas fa-magic"></i> ç’°å¢ƒå¤‰æ•°ã‚’è‡ªå‹•è¨­å®š
                            </button>
                        </div>
                    </div>

                    <!-- ã‚¹ãƒ†ãƒƒãƒ—4: å®Œäº†ç¢ºèª -->
                    <div class="setup-card card" id="step4Card" style="display: none;">
                        <div class="card-header bg-success text-white">
                            <h5><i class="fas fa-check-circle"></i> ã‚¹ãƒ†ãƒƒãƒ—4: è¨­å®šå®Œäº†</h5>
                        </div>
                        <div class="card-body text-center">
                            <div class="mb-4">
                                <i class="fas fa-check-circle text-success" style="font-size: 4rem;"></i>
                            </div>
                            <h4>ğŸ‰ Railwayãƒˆãƒ¼ã‚¯ãƒ³è¨­å®šãŒå®Œäº†ã—ã¾ã—ãŸï¼</h4>
                            <p class="text-muted">ã“ã‚Œã§ä¼æ¥­ç™»éŒ²æ™‚ã®è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ãŒå¯èƒ½ã«ãªã‚Šã¾ã™</p>
                            <div class="row mt-4">
                                <div class="col-md-6">
                                    <a href="/company-registration" class="btn btn-primary w-100">
                                        <i class="fas fa-building"></i> ä¼æ¥­ç™»éŒ²ã‚’ãƒ†ã‚¹ãƒˆ
                                    </a>
                                </div>
                                <div class="col-md-6">
                                    <a href="/" class="btn btn-outline-secondary w-100">
                                        <i class="fas fa-home"></i> ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let currentStep = 1;
        let railwayToken = '';
        let projectId = '';

        // ã‚¹ãƒ†ãƒƒãƒ—æ›´æ–°
        function updateStep(step) {
            currentStep = step;
            
            // ã‚¹ãƒ†ãƒƒãƒ—ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼æ›´æ–°
            for (let i = 1; i <= 4; i++) {
                const stepElement = document.getElementById(`step${i}`);
                const cardElement = document.getElementById(`step${i}Card`);
                
                if (i < step) {
                    stepElement.className = 'step completed';
                    cardElement.style.display = 'none';
                } else if (i === step) {
                    stepElement.className = 'step active';
                    cardElement.style.display = 'block';
                } else {
                    stepElement.className = 'step';
                    cardElement.style.display = 'none';
                }
            }
        }

        // ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼
        async function validateToken() {
            const token = document.getElementById('railwayToken').value.trim();
            
            if (!token) {
                showStatus('danger', 'ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            if (!token.startsWith('railway_')) {
                showStatus('danger', 'æœ‰åŠ¹ãªRailwayãƒˆãƒ¼ã‚¯ãƒ³ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            showStatus('info', 'ãƒˆãƒ¼ã‚¯ãƒ³ã‚’æ¤œè¨¼ä¸­...');
            
            try {
                const response = await fetch('/api/v1/railway/validate-token', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ token: token })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    railwayToken = token;
                    document.getElementById('displayToken').textContent = token.substring(0, 20) + '...';
                    showStatus('success', 'ãƒˆãƒ¼ã‚¯ãƒ³ãŒæœ‰åŠ¹ã§ã™');
                    setTimeout(() => updateStep(2), 1000);
                } else {
                    showStatus('danger', result.error || 'ãƒˆãƒ¼ã‚¯ãƒ³ã®æ¤œè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            } catch (error) {
                showStatus('danger', 'ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
            }
        }

        // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆIDæ¤œè¨¼
        async function validateProjectId() {
            const projectIdInput = document.getElementById('projectId').value.trim();
            
            if (!projectIdInput) {
                showStatus('danger', 'ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆIDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            if (!/^[a-f0-9-]{36}$/.test(projectIdInput)) {
                showStatus('danger', 'æœ‰åŠ¹ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆIDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            showStatus('info', 'ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆIDã‚’æ¤œè¨¼ä¸­...');
            
            try {
                const response = await fetch('/api/v1/railway/validate-project', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        token: railwayToken,
                        project_id: projectIdInput 
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    projectId = projectIdInput;
                    document.getElementById('displayProjectId').textContent = projectId;
                    showStatus('success', 'ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆIDãŒæœ‰åŠ¹ã§ã™');
                    setTimeout(() => updateStep(3), 1000);
                } else {
                    showStatus('danger', result.error || 'ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆIDã®æ¤œè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            } catch (error) {
                showStatus('danger', 'ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆIDæ¤œè¨¼ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
            }
        }

        // ç’°å¢ƒå¤‰æ•°è¨­å®š
        async function setupEnvironmentVariables() {
            showStatus('info', 'ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šä¸­...');
            
            try {
                const response = await fetch('/api/v1/railway/setup-environment', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        token: railwayToken,
                        project_id: projectId,
                        base_domain: 'lp-production-9e2c.up.railway.app'
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showStatus('success', 'ç’°å¢ƒå¤‰æ•°ã®è¨­å®šãŒå®Œäº†ã—ã¾ã—ãŸ');
                    setTimeout(() => updateStep(4), 1000);
                } else {
                    showStatus('danger', result.error || 'ç’°å¢ƒå¤‰æ•°ã®è¨­å®šã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            } catch (error) {
                showStatus('danger', 'ç’°å¢ƒå¤‰æ•°è¨­å®šä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
            }
        }

        // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º
        function showStatus(type, message) {
            const statusArea = document.getElementById('statusArea');
            statusArea.innerHTML = `
                <div class="alert alert-${type} alert-dismissible fade show" role="alert">
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;
        }

        // ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼
        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            const text = element.textContent;
            
            navigator.clipboard.writeText(text).then(() => {
                showStatus('success', 'ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ');
            }).catch(() => {
                showStatus('danger', 'ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ');
            });
        }

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            updateStep(1);
        });
    </script>
</body>
</html> 